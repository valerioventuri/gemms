/* define absolute paths of filesets */

define(CMS_DATA_PATH,/gpfs_tsm/cms/store/data)
define(CMS_MC_PATH,/gpfs_tsm/cms/store/mc)

/* placement policy */

RULE 'DEFAULT' SET POOL 'system'

/* define external tape pool for garbage collector */

RULE EXTERNAL POOL 'TAPE MIGRATION CMS_GARBAGE_COLLECTION'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsGarbageCollection gpfs_tsm'

/* define external tape pools for the data storage areas  */

RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_DATA_RAW'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsData gpfs_tsm'
RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_DATA_RECO'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsData gpfs_tsm'
RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_MC'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsMc gpfs_tsm'
RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_DATA_OLD'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsDataOld gpfs_tsm'
RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_MC_OLD'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsMcOld gpfs_tsm'
RULE EXTERNAL POOL 'TAPE PREMIGRATION CMS_PREPROD'
   EXEC '/var/mmfs/etc/hsmControl' OPTS 'CmsPreProd gpfs_tsm'

/* Exclude from migration hidden directories (e.g. .SpaceMan), baby files, hidden and weird files. */

RULE 'exclude hidden directories' EXCLUDE WHERE PATH_NAME LIKE '%/.%'
RULE 'exclude hidden file' EXCLUDE WHERE NAME LIKE '.%'
RULE 'exclude empty files' EXCLUDE WHERE FILE_SIZE=0
RULE 'exclude baby files' EXCLUDE
   WHERE (CURRENT_TIMESTAMP-MODIFICATION_TIME)<INTERVAL '3' MINUTE

/* Define migrate rule for the garbage collector */

RULE 'migrate just already premigrated files' 
   MIGRATE FROM POOL 'system' THRESHOLD(0,80,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME) 
   TO POOL 'TAPE MIGRATION CMS_GARBAGE_COLLECTION'
   FOR FILESET('CmsData','CmsMc') WHERE
     MISC_ATTRIBUTES LIKE '%M%'

/* Define (pre)migrate rules to external pools */

RULE 'premigrate from system to tape cms preprod'
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME)
   TO POOL 'TAPE PREMIGRATION CMS_PREPROD'
   FOR FILESET('CmsData','CmsMc') WHERE
     PATH_NAME LIKE '%/%_preproduction_%/%'

RULE 'premigrate from system to tape cms mc old'
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME)
   TO POOL 'TAPE PREMIGRATION CMS_MC_OLD'
   FOR FILESET('CmsMc') WHERE
     PATH_NAME LIKE 'CMS_MC_PATH/2007/%' OR
     PATH_NAME LIKE 'CMS_MC_PATH/2008/%' OR
     PATH_NAME LIKE 'CMS_MC_PATH/CSA08/%'

RULE 'premigrate from system to tape cms mc' 
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME) 
   TO POOL 'TAPE PREMIGRATION CMS_MC'
   FOR FILESET('CmsMc') WHERE
     PATH_NAME LIKE 'CMS_MC_PATH/Summer08/%' OR
     PATH_NAME LIKE 'CMS_MC_PATH/Summer09/%' OR
     PATH_NAME LIKE 'CMS_MC_PATH/Fall08/%' OR
     PATH_NAME LIKE 'CMS_MC_PATH/Winter09/%'

RULE 'premigrate from system to tape cms data reco' 
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME) 
   TO POOL 'TAPE PREMIGRATION CMS_DATA_RECO'
   FOR FILESET('CmsData') WHERE
     PATH_NAME LIKE '%/RECO/%' OR
     PATH_NAME LIKE '%/ALCARECO/%'

RULE 'premigrate from system to tape cms data raw' 
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME) 
   TO POOL 'TAPE PREMIGRATION CMS_DATA_RAW'
   FOR FILESET('CmsData') WHERE
     PATH_NAME LIKE '%/RAW/%' OR
     NAME LIKE '%.dat' OR
     PATH_NAME LIKE '%/RAW-RECO/%'

RULE 'premigrate from system to tape cms data old' 
   MIGRATE FROM POOL 'system' THRESHOLD(0,100,0)
   WEIGHT(CURRENT_TIMESTAMP-ACCESS_TIME) 
   TO POOL 'TAPE PREMIGRATION CMS_DATA_OLD'
   FOR FILESET('CmsData') WHERE
     PATH_NAME LIKE 'CMS_DATA_PATH/2008/%'

