#!/bin/bash

is_x86_64=$(uname -a | grep x86_64)

if [ "$is_x86_64"x != "x" ]; then
  echo Architecture is x86_64
  sed -e 's/^MYLFOPTS=.*/MYLFOPTS=/g' -e 's/^MYPRBIN=.*/MYPRBIN=bin64/g' -e 's/^MYPRLIB=.*/MYPRLIB=lib64/g' src/c/makefile > /tmp/ymake
  mv /tmp/ymake src/c/makefile
  sed -e 's/^MYPRBIN=.*/MYPRBIN=bin64/g' -e 's/^MYPRLIB=.*/MYPRLIB=lib64/g' -e 's/^MYPR=.*/MYPR=64/g' rpm/makerpm.sh > /tmp/ymake
  mv /tmp/ymake rpm/makerpm.sh
  make clean
else
  echo Architecture is not x86_64
  sed -e 's/^MYLFOPTS=.*/MYLFOPTS=-D_LARGE_FILE_SOURCE -D_FILE_OFFSET_BITS=64/g' -e 's/^MYPRBIN=.*/MYPRBIN=bin/g' -e 's/^MYPRLIB=.*/MYPRLIB=lib/g' src/c/makefile > /tmp/ymake
  mv /tmp/ymake src/c/makefile
  sed -e 's/^MYPRBIN=.*/MYPRBIN=bin/g' -e 's/^MYPRLIB=.*/MYPRLIB=lib/g' -e 's/^MYPR=.*/MYPR=32/g' rpm/makerpm.sh > /tmp/ymake
  mv /tmp/ymake rpm/makerpm.sh
  make clean
fi
